# MeetingEZ 使用指南

## 快速开始

### 1. 安装和启动

```bash
# 激活虚拟环境
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 启动服务
python run.py
```

服务将在 `http://localhost:5090` 启动。

### 2. 配置 OpenAI API Key

1. 打开浏览器访问应用地址
2. 在"OpenAI API Key"输入框中输入您的API Key
3. 点击"测试连接"验证API Key是否有效
4. 点击"保存"将API Key保存到浏览器本地存储

### 3. 开始会议转录

1. 点击"开始会议"按钮
2. 浏览器会请求麦克风权限，请选择"允许"
3. 开始说话，应用将实时显示语音转录结果
4. 使用"使用语言"选择器决定识别语言（主要语言或第二语言）。本版本会对转写结果进行“后置处理”：
   - 先即时显示原始转写（临时记录）
   - 后置处理返回后保留原文；若该段为第二语言，则在其下一行插入第一语言（中文）翻译
5. 点击"结束会议"时，会立即停止录音，但已发送的转写请求与翻译请求会继续完成，确保最后的内容不会丢失

## 功能详解

### 音频输入源选择

MeetingEZ 支持两种音频输入源：

#### 1. 标准麦克风输入
- 捕获物理麦克风或系统音频输入设备
- 适合会议中自己说话的场景
- 支持选择特定的音频输入设备

#### 2. 浏览器标签页音频捕获（推荐用于转录远程会议）
- 使用浏览器的 `getDisplayMedia` API 捕获其他标签页的音频
- **适用场景**：转录运行在其他浏览器标签页中的会议（如 Google Meet、Zoom 网页版等）
- **操作步骤**：
  1. 在"输入设备"下方选择"使用标签页音频"单选按钮
  2. 点击"开始会议"
  3. 浏览器会弹出"选择要共享的内容"对话框
  4. 选择"Chrome 标签页"（或对应浏览器的标签页选项）
  5. 勾选"共享标签页音频"或"共享该标签页音频"选项
  6. 选择要捕获音频的标签页（例如正在进行 Google Meet 的标签页）
  7. 点击"共享"

- **兼容性**：
  - Chrome/Edge 80+：完整支持标签页音频捕获
  - Firefox：支持有限，可能无法捕获标签页音频
  - Safari：不支持标签页音频捕获
  
- **注意事项**：
  - 只能捕获浏览器标签页的音频，无法捕获系统级其他应用的音频
  - 被共享的标签页音频会被捕获，但本标签页（MeetingEZ）的音频不会产生回声
  - 结束会议时，标签页共享会自动停止
  - 如需切换回麦克风输入，需先停止会议，选择"使用麦克风"，再重新开始会议

### 实时语音识别（分段直连 OpenAI Transcribe，单通道）

- **音频格式**: WAV/PCM16, 48kHz, 单声道（浏览器端编码）
- **识别模型**: OpenAI `gpt-4o-transcribe`（接口：`/v1/audio/transcriptions`）
- **分段策略**: 8 秒分段，1 秒重叠（带前段尾部上下文）
- **并发策略**: 允许多个分段并行上传（降低端到端延迟）
- **语言选择**: 提供主要语言选择器，并可设置第二语言；默认单栏展示，不启用分屏。

### 单通道与展示

- **单通道**: 每段音频仅上传一次。所用语言由“使用语言”选择器决定。
- **上下文传递**: 每段附上上一段的短尾文本（约 200 字符）作为 `prompt`。
- **展示**: 默认单栏；若设置了第二语言，则在该段原文后插入中文翻译（同栏）。

### 字幕管理

- **实时显示**: 最新内容自动滚动显示
- **历史记录**: 支持滚动查看历史内容
- **本地存储**: 自动保存到浏览器 Local Storage
- **数据导出**: 支持导出为TXT文件

### 界面操作

#### 控制面板
- **API Key配置**: 输入、测试和保存API Key
- **会议控制**: 开始/停止会议
- **状态显示**: 实时显示会议和音频状态
- **数据管理**: 下载记录、清空记录
  - 清空记录会设置隐藏阈值，仅阈值之后的新记录会显示

#### 字幕区域
- **自动滚动**: 开关按钮控制自动滚动
- **清屏功能**: 清空屏幕显示（不影响本地存储）
- **字体大小**: 小、中、大三种字体选项
- 始终单栏展示。

#### 设置面板
- **主要语言**: 选择主要识别语言
- **字体设置**: 调整字幕显示字体大小
- **保存设置**: 设置自动保存到本地存储

## 浏览器兼容性

### 必需功能支持
- **Web Audio API**: 音频处理
- **MediaDevices API**: 麦克风访问
- **Local Storage**: 数据存储
- **Fetch/FormData**: 直接调用 OpenAI REST 接口

### 支持的浏览器
- Chrome 80+ (推荐)
- Firefox 75+
- Safari 13+
- Edge 80+

### 网络要求
- **HTTPS**: 生产环境需要HTTPS
- **稳定连接**: 建议使用稳定的网络连接
- **防火墙**: 允许访问 `api.openai.com`（HTTP/S 标准端口）

## 常见问题

### Q: API Key安全吗？
A: API Key仅存储在您浏览器的本地存储中，不会发送到服务器。所有请求都直接发送到OpenAI服务器。

### Q: 支持哪些语言？
A: 支持多语言；当某段为第二语言时会插入第一语言（中文）的翻译，其余情况保留原文。

### Q: 数据会泄露吗？
A: 所有音频数据仅发送到OpenAI进行处理，不在本地服务器存储。字幕和翻译存储在浏览器本地存储中。

### Q: 离线使用吗？
A: 不支持离线使用。需要网络连接才能访问OpenAI的API服务。

### Q: 转录准确率如何？
A: 转录准确率取决于音质、语速、发音清晰度等因素。建议在安静环境中使用，说话清晰。

## 快捷键

- **Ctrl+Enter**: 保存API Key
- **Space**: 开始/停止会议（需要Focus在控制区域）
- **Ctrl+S**: 下载转录记录
- **Ctrl+R**: 清空记录

## 性能优化建议

### 音频质量
- 使用高质量的麦克风设备
- 保持适当的说话距离
- 减少背景噪音

### 网络环境
- 使用稳定的网络连接
- 避免在高峰时段使用
- 确保网络延迟较低

### 浏览器设置
- 关闭不必要的浏览器扩展
- 释放内存资源
- 使用最新版本浏览器

## 技术支持

如遇到问题，请检查：

1. **网络连接**: 确保能访问OpenAI API
2. **浏览器兼容性**: 使用支持的浏览器版本
3. **麦克风权限**: 确保已授权浏览器访问麦克风
4. **API Key**: 验证API Key有效且有足够配额

---

*最后更新: 2025年10月*
